function bricksCustomFontsUpload(){for(var e=document.querySelectorAll(".bricks-font-variant .upload"),t=[],a=0;a<e.length;a++)e[a].classList.contains("initialized")||(e[a].classList.add("initialized"),e[a].addEventListener("click",n));var r=document.querySelectorAll(".bricks-font-variant .remove");for(a=0;a<r.length;a++)r[a].addEventListener("click",(function(e){e.preventDefault(),e.target.classList.add("hide"),e.target.parentNode.querySelector(".upload").classList.remove("hide"),e.target.parentNode.querySelector("[name=font_url]").value="",e.target.parentNode.querySelector("[name=font_id]").value=""}));function n(e){e.preventDefault();var a=e.target.id,r=e.target.dataset.mimeType,n=e.target.dataset.extension,o=e.target.dataset.id;if(t[a])t[a].open();else{t[a]=wp.media.frames.file_frame=wp.media({title:e.target.dataset.title,library:{type:r},multiple:!1});var i=_wpPluploadSettings.defaults.filters.mime_types[0].extensions;t[a].on("ready",(function(){_wpPluploadSettings.defaults.filters.mime_types[0].extensions=n})),t[a].on("close",(function(){_wpPluploadSettings.defaults.filters.mime_types[0].extensions=i})),t[a].on("insert select",(function(){var r=t[a].state().get("selection").first().toJSON();e.target.parentNode.querySelector("[name=font_url]").value=r.url,e.target.parentNode.querySelector("[name=font_id]").value=r.id,e.target.classList.add("hide"),e.target.parentNode.querySelector(".remove").classList.remove("hide")})),t[a].on("open",(function(){o&&t[a].state().get("selection").add(wp.media.attachment(o))})),t[a].open(),t[a].uploader.uploader.param("bricksCustomFontsUpload",!0)}}}function bricksCustomSaveFontFaces(){var e=document.querySelector("form#post");if(e){var t=!0;e.addEventListener("submit",(function(a){if(t){a.preventDefault();for(var r=a.target.querySelectorAll(".bricks-font-variant"),n={},o=0;o<r.length;o++)for(var i=r[o],s=i.querySelector("[name=font_weight]").value,l=i.querySelector("[name=font_style]").value,c=i.querySelectorAll(".font-face"),u=0;u<c.length;u++){var d=c[u],f=d.querySelector("[name=font_id]").value,m=d.querySelector("[name=font_url]").value.split(".").pop();f&&m&&(i=s+l,n.hasOwnProperty(i)||(n[i]={}),n[i][m]=parseInt(f))}var v=document.getElementById("post_ID"),p=v?v.value:0,y=e.querySelector("#publishing-action input[type=submit]");p?window.wp.ajax.send("bricks_save_font_faces",{data:{nonce:window.bricksData.nonce,post_id:p,font_faces:JSON.stringify(n)},success:function(e){t=!1,y.classList.remove("disabled"),y.click()},error:function(e){t=!1,y.classList.remove("disabled"),y.click()}}):e.submit()}}))}}function bricksCustomFontsAddVariant(){var e=document.getElementById("bricks-custom-fonts-add-font-variant");e&&e.addEventListener("click",(function(e){e.preventDefault();var t=document.querySelectorAll(".bricks-font-variant"),a=t[t.length-1],r=!!a&&a.cloneNode(!0);r&&(r.querySelector("[name=font_weight]").selectedIndex=3,r.querySelector("[name=font_style]").selectedIndex=0,r.querySelectorAll("input").forEach((function(e){e.value=""})),r.querySelectorAll(".initialized").forEach((function(e){e.classList.remove("initialized")})),r.querySelector("style")&&r.querySelector("style").remove(),r.querySelector(".pangram").removeAttribute("style"),r.querySelectorAll("button").forEach((function(e){e.classList.contains("upload")?(e.classList.remove("hide"),e.id=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,12)):e.classList.contains("remove")&&e.classList.add("hide")})),a.after(r),bricksCustomFontsUpload(),bricksCustomFontsToggleEdit(),bricksCustomFontsDeleteVariant())}))}function bricksCustomFontsToggleEdit(){for(var e=document.querySelectorAll("#bricks-font-metabox .actions .edit"),t=0;t<e.length;t++)e[t].classList.contains("initialized")||(e[t].classList.add("initialized"),e[t].addEventListener("click",(function(e){e.preventDefault();var t=e.target.innerText;e.target.innerText=e.target.dataset.label,e.target.dataset.label=t,e.target.closest(".bricks-font-variant").querySelector(".font-faces").classList.toggle("hide")})))}function bricksCustomFontsDeleteVariant(){for(var e=document.querySelectorAll("#bricks-font-metabox .actions .delete"),t=0;t<e.length;t++)e[t].classList.contains("initialized")||(e[t].classList.add("initialized"),e[t].addEventListener("click",(function(e){var t=document.querySelectorAll(".bricks-font-variant");if(e.preventDefault(),t.length>1)e.target.closest(".bricks-font-variant").remove();else{var a=t[0];a.querySelector("[name=font_weight]").value=400,a.querySelector("[name=font_style]").value="";for(var r=a.querySelectorAll("input"),n=0;n<r.length;n++)r[n].value="";var o=a.querySelector("style");o&&o.remove();var i=a.querySelector(".pangram");i&&i.removeAttribute("style")}})))}document.addEventListener("DOMContentLoaded",(function(e){bricksCustomFontsUpload(),bricksCustomSaveFontFaces(),bricksCustomFontsAddVariant(),bricksCustomFontsToggleEdit(),bricksCustomFontsDeleteVariant()}));
