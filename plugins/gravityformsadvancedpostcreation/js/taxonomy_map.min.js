var GFTaxonomyMap=function(e){var i=this;return i.options=e,i.UI=jQuery("#gform_setting_"+i.options.fieldName),i.init=function(){i.options.formFields=JSON.parse(i.options.formFields),i.options.preloadedTerms=JSON.parse(i.options.preloadedTerms),i.parsePreloadedTerms(),i.bindEvents(),i.setupData(),i.setupRepeater()},i.decodeHtml=function(e){return jQuery("<textarea/>").html(e).text()},i.parsePreloadedTerms=function(){for(key in i.options.preloadedTerms)i.options.preloadedTerms[key]=i.decodeHtml(i.options.preloadedTerms[key])},i.bindEvents=function(){i.UI.on("change",'select[name="_gform_setting_'+i.options.keyFieldName+'"]',function(){i.setupRow(jQuery(this).closest("tr"),{})}),i.UI.closest("form").on("submit",function(e){jQuery('[name^="_gform_setting_'+i.options.fieldName+'_"]').each(function(e){jQuery(this).removeAttr("name")})})},i.setupData=function(){var e=jQuery("#"+i.options.fieldId).val();i.data=e?jQuery.parseJSON(e):null,i.data||(i.data=[{key:"",value:"",custom_value:""}])},i.setupRow=function(e,o){var t=e.find('select[name="_gform_setting_'+i.options.keyFieldName+'"]'),n=e.find('select[name="_gform_setting_'+i.options.valueFieldName+'"]'),a=n.closest("tr").find(".custom-value-container"),e=(t.select2({minimumResultsForSearch:1/0}),t.siblings(".select2-container"),n.data("select2")?n.siblings(".select2-container"):n);if("gf_custom"===t.val()||"gf_custom"===o.value)e.hide(),a.show();else switch(a.hide(),n.data("select2")&&n.select2("destroy"),n.find("option").each(function(){0!=this.value.length&&jQuery(this).remove()}),t.val()){case"field":n.removeAttr("disabled");var s="";jQuery.each(i.options.formFields,function(e,t){"category"!==i.options.taxonomy&&"post_category"===t.type||(n.append(jQuery("<option>",{value:t.value,text:t.label})),o.value==t.value&&(s=o.value))}),0<s.length&&n.val(s),n.select2();break;case"term":n.removeAttr("disabled"),i.options.preloadedTerms[o.value]&&(n.append(jQuery("<option>",{value:o.value,text:i.options.preloadedTerms[o.value]})),n.val(o.value)),n.select2({ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"gform_advancedpostcreation_taxonomy_search",nonce:gform_advancedpostcreation_form_settings_strings.nonce_search,taxonomy:i.options.taxonomy,query:e.term}}}}),n.on("select2:selecting",function(e){e=e.params.args.data;"gf_custom"===e.id&&(n.select2("destroy").hide(),a.show()),i.options.preloadedTerms[e.id]||(i.options.preloadedTerms[e.id]=e.text)});break;default:n.attr("disabled","disabled"),n.select2()}},i.setupRepeater=function(){var e=0<i.options.limit?i.options.limit:0;i.UI.find("tbody.repeater").repeater({limit:e,items:i.data,addButtonMarkup:'<button class="add_field_choice gform-st-icon gform-st-icon--circle-plus gform-settings-generic-map__button gform-settings-generic-map__button--add"><span class="screen-reader-text">Add</span></button>',removeButtonMarkup:'<button class="delete_field_choice gform-st-icon gform-st-icon--circle-minus gform-settings-generic-map__button gform-settings-generic-map__button--delete"><span class="screen-reader-text">Delete</span></button>',callbacks:{add:function(e,t,o){i.setupRow(t,o)},save:function(e,t){jQuery("#"+i.options.fieldId).val(JSON.stringify(t))}}})},i.init()};