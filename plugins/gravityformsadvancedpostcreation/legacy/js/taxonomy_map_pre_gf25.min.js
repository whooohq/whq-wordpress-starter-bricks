var GFTaxonomyMap=function(e){var i=this;return i.options=e,i.UI=jQuery("#gaddon-setting-row-"+i.options.fieldName),i.init=function(){i.options.formFields=JSON.parse(i.options.formFields),i.options.preloadedTerms=JSON.parse(i.options.preloadedTerms),i.bindEvents(),i.setupData(),i.setupRepeater()},i.bindEvents=function(){i.UI.on("change",'select[name="_gaddon_setting_'+i.options.keyFieldName+'"]',function(){i.setupRow(jQuery(this).parent().parent(),{})}),i.UI.closest("form").on("submit",function(e){jQuery('[name^="_gaddon_setting_'+i.options.fieldName+'_"]').each(function(e){jQuery(this).removeAttr("name")})})},i.setupData=function(){var e=jQuery("#"+i.options.fieldId).val();i.data=e?jQuery.parseJSON(e):null,i.data||(i.data=[{key:"",value:"",custom_value:""}])},i.setupRow=function(e,a){var t=e.find('select[name="_gaddon_setting_'+i.options.keyFieldName+'"]'),o=e.find('select[name="_gaddon_setting_'+i.options.valueFieldName+'"]'),n=o.siblings(".custom-value-container"),e=(t.select2({minimumResultsForSearch:1/0}),t.siblings(".select2-container"),o.data("select2")?o.siblings(".select2-container"):o);if("gf_custom"===t.val()||"gf_custom"===a.value)e.hide(),n.show();else switch(n.hide(),o.data("select2")&&o.select2("destroy"),o.find("option").each(function(){0!=this.value.length&&jQuery(this).remove()}),t.val()){case"field":o.removeAttr("disabled");var s="";jQuery.each(i.options.formFields,function(e,t){"category"!==i.options.taxonomy&&"post_category"===t.type||(o.append(jQuery("<option>",{value:t.value,text:t.label})),a.value==t.value&&(s=a.value))}),0<s.length&&o.val(s),o.select2();break;case"term":o.removeAttr("disabled"),i.options.preloadedTerms[a.value]&&(o.append(jQuery("<option>",{value:a.value,text:i.options.preloadedTerms[a.value]})),o.val(a.value)),o.select2({ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"gform_advancedpostcreation_taxonomy_search",nonce:gform_advancedpostcreation_form_settings_strings.nonce_search,taxonomy:i.options.taxonomy,query:e.term}}}}),o.on("select2:selecting",function(e){e=e.params.args.data;"gf_custom"===e.id&&(o.select2("destroy").hide(),n.show()),i.options.preloadedTerms[e.id]||(i.options.preloadedTerms[e.id]=e.text)});break;default:o.attr("disabled","disabled"),o.select2()}},i.setupRepeater=function(){var e=0<i.options.limit?i.options.limit:0;i.UI.find("tbody.repeater").repeater({limit:e,items:i.data,addButtonMarkup:'<i class="gficon-add"></i>',removeButtonMarkup:'<i class="gficon-subtract"></i>',callbacks:{add:function(e,t,a){i.setupRow(t,a)},save:function(e,t){jQuery("#"+i.options.fieldId).val(JSON.stringify(t))}}})},i.init()};