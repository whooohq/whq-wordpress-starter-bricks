jQuery(document).ready((function(t){function e(t,e){var o=t.find("[data-piotnetforms-stripe]");o.length&&e.each(o,(function(t,o){var a=e("[data-piotnetforms-stripe-key]").data("piotnetforms-stripe-key"),s=Stripe(a),r=e(this).attr("data-piotnetforms-form-builder-stripe-font-family"),n=s.elements({fonts:[{cssSrc:r}]}),d=e(this).attr("data-piotnetforms-stripe-custom-style");if(d)var p=JSON.parse(d);else{var l=e(this).attr("data-piotnetforms-stripe-style");p={base:{backgroundColor:(l=JSON.parse(l)).backgroundColor,color:l.color,fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:l.fontSize,"::placeholder":{color:l.placeholderColor}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},l.iconColor&&(p.base.iconColor=l.iconColor)}var f=n.create("card",{style:p});f.mount(o),e(document).on("click","[data-piotnetforms-submit-form-id][data-piotnetforms-stripe-submit]",(function(){if(null!=e(this).data("piotnetforms-stripe-submit")){var t=e(this).data("piotnetforms-submit-form-id"),o=e(document).find('[data-piotnetforms-id="'+t+'"]'),a=e(this).data("piotnetforms-required-text"),r=[],n=0,d=new FormData,p=!1,l=e(this),m=l.closest(".piotnetforms-submit");o.each((function(){if(null==e(this).data("piotnetforms-stripe")&&null==e(this).data("piotnetforms-html")){var i=e(this).closest(".piotnetforms-field-type-checkbox.piotnetforms-field-required"),o=0;i.length>0&&(o=i.find("input[type=checkbox]:checked").length),null!=e(this).attr("oninvalid")&&(a=e(this).attr("oninvalid").replace("this.setCustomValidity('","").replace("')",""));var s=e(this)[0].checkValidity(),l=e(e(this)[0]).next()[0];if(e(l).hasClass("flatpickr-mobile")&&(s=l.checkValidity()),!s&&0==e(this).closest(".piotnetforms-conditional-logic-hidden").length&&"none"!=e(this).closest("[data-piotnetforms-conditional-logic]").css("display")&&0==e(this).closest("[data-piotnetforms-signature]").length||0==o&&i.length>0&&"none"!=e(this).closest(".piotnetforms-fields-wrapper").css("display")){if("none"==e(this).css("display")||null!=e(this).data("piotnetforms-image-select")||i.length>0){e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(a);var f=e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").next();0===f.length||p||(e("html, body").animate({scrollTop:f.offset().top-100},500),p=!0)}else p||null!=e(this).data("piotnetforms-image-select")||(e(this)[0].reportValidity(),p=!0);n++}else if(""==e(this).val()&&0==e(this).closest(".piotnetforms-conditional-logic-hidden").length&&"true"==e(this).attr("aria-required")&&void 0!==e(this).attr("data-piotnetforms-select-autocomplete"))e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(a),n++;else{null!=e(this).data("piotnetforms-image-select")&&(e(this).closest(".piotnetforms-image-select-field").find(".image_picker_selector").find(".selected").length<e(this).data("piotnetforms-image-select-min-select")?(e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-image_select_min_select_check]").html(e(this).data("piotnetforms-image-select-min-select-message")),n++):e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-image_select_min_select_check]").remove()),e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(""),null!=e(this).data("piotnetforms-flatpickr-custom-options")&&""==e(this).val()&&0==e(this).closest(".piotnetforms-conditional-logic-hidden").length&&null!=e(this).attr("required")&&(e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(a),n++),e(this).closest("[data-piotnetforms-signature]").length>0&&(e(this).closest("[data-piotnetforms-signature]").find("[data-piotnetforms-signature-export]").trigger("click"),""==e(this).val()&&"required"==e(this).attr("required")&&(e(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(a),n++));var m=e(this).attr("type"),c=e(this).attr("name"),u=e(this).closest("[data-piotnetforms-repeater-form-id]"),h="",g="",_="",v=-1,y=0;if(u.length>0){var b=e(this).parents("[data-piotnetforms-repeater-form-id]");g=u.data("piotnetforms-repeater-id"),b.each((function(){var i=e(this).data("piotnetforms-repeater-id"),o=e(document).find('[data-piotnetforms-repeater-form-id="'+t+'"][data-piotnetforms-repeater-id="'+i+'"]'),a=e(this).index()-o.index();h+=i+"|index"+a+"|"+c.replace("[]","").replace("form_fields[","").replace("]","")+","})),_=u.data("piotnetforms-repeater-label");var k=e(document).find('[data-piotnetforms-repeater-id="'+u.data("piotnetforms-repeater-id")+'"]');y=u.siblings('[data-piotnetforms-repeater-id="'+u.data("piotnetforms-repeater-id")+'"]').length+1,v=u.index()-k.index()}if("file"==m)e(this).hasClass("error")?n++:(c=e(this).attr("id").replace("form-field-",""),e.each(e(this)[0].files,(function(t,e){d.append(c+"[]",e)})),(T={}).label=e(this).closest(".piotnetforms-field-group").find(".piotnetforms-field-label").html(),T.name=c,T.value="",T.type=e(this).attr("type"),T.upload=1,T.repeater_id=h,T.repeater_id_one=g,T.repeater_label=_,T.repeater_index=v,T.repeater_length=y,null!=e(this).data("piotnetforms-remove-this-field-from-repeater")&&(T.repeater_remove_this_field="1"),null!=e(this).data("piotnetforms-remove-this-field-from-repeater")&&(T.repeater_remove_this_field="1"),null!=e(this).data("attach-files")&&(T["attach-files"]=1),r.push(T));else{if(-1!==c.indexOf("[]")){var x=[];"checkbox"==m?e(document).find('[name="'+c+'"]:checked').each((function(){x.push(e(this).val())})):null==(x=e(this).val())&&(x=[]),j="";for(var w="",C=[],S=0;S<x.length;S++){if(null!=e(this).data("piotnetforms-send-data-by-label")){var O=x[S];"checkbox"==m?(q=e(this).closest(".piotnetforms-fields-wrapper").find('[value="'+O+'"]')).length>0&&(w+=q.data("piotnetforms-send-data-by-label")+","):(q=e(this).find('[value="'+O+'"]')).length>0&&(w+=q.html()+",")}j+=x[S]+",",null!=e(this).attr("data-piotnetforms-booking-item-options")&&(O=x[S],(q=e(this).closest(".piotnetforms-fields-wrapper").find('[value="'+O+'"]')).length>0&&C.push(q.attr("data-piotnetforms-booking-item-options")))}j=j.replace(/,(\s+)?$/,"")}else if("radio"==m||"checkbox"==m){null!=e(this).data("piotnetforms-send-data-by-label")&&(w=e(this).closest(".piotnetforms-fields-wrapper").find('[name="'+c+'"]:checked').data("piotnetforms-send-data-by-label"));var j=e(this).closest(".piotnetforms-fields-wrapper").find('[name="'+c+'"]:checked').val()}else if(null!=e(this).data("piotnetforms-calculated-fields"))j=e(this).siblings(".piotnetforms-calculated-fields-form").text();else{var q;if(null!=e(this).data("piotnetforms-send-data-by-label"))O=e(this).val().trim(),(q=e(this).find('[value="'+O+'"]')).length>0&&(w=q.html());j=e(this).val().trim()}var T;null!=j&&((T={}).label=e(this).closest(".piotnetforms-field-group").find(".piotnetforms-field-label").html(),T.name=c.replace("[]","").replace("form_fields[","").replace("]",""),T.value=j,null!=x&&(T.value_multiple=x),T.type=e(this).attr("type"),void 0!==e(this).attr("data-piotnetforms-address-autocomplete")&&(T.lat=e(this).attr("data-piotnetforms-google-maps-lat"),T.lng=e(this).attr("data-piotnetforms-google-maps-lng"),T.zoom=e(this).attr("data-piotnetforms-google-maps-zoom")),void 0!==C&&C.length>0&&(T.booking=C),""!=w&&(T.value_label=w),e(this).closest(".piotnetforms-field-type-calculated_fields").length>0&&(T.calculation_results=e(this).val().trim()),0==e(this).closest(".piotnetforms-conditional-logic-hidden").length&&(T.repeater_id=h,T.repeater_id_one=g,T.repeater_index=v,T.repeater_label=_,T.repeater_length=y,null!=e(this).data("piotnetforms-remove-this-field-from-repeater")&&(T.repeater_remove_this_field="1")),r.push(T))}}}})),0==n&&s.createToken(f).then((function(o){if(o.error);else{e(document).find('[data-piotnetforms-id="'+t+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:.45}),l.closest(".piotnetforms-submit").css({opacity:.45}),l.closest(".piotnetforms-submit").addClass("piotnetforms-waiting"),m.find(".piotnetforms-message").removeClass("visible");var a=0;if(null!=l.data("piotnetforms-stripe-amount-field")){var n=l.data("piotnetforms-stripe-amount-field").replace('[field id="',"").replace('"]',"");a=e(document).find('[data-piotnetforms-id="'+t+'"][name="form_fields['+n+']"]').val()}else null!=l.data("piotnetforms-stripe-amount")&&(a=l.data("piotnetforms-stripe-amount"));var p="";if(null!=l.data("piotnetforms-stripe-customer-info-field")){var c=l.data("piotnetforms-stripe-customer-info-field").replace('[field id="',"").replace('"]',"");p=e(document).find('[data-piotnetforms-id="'+t+'"][name="form_fields['+c+']"]').val()}if(d.append("action","piotnetforms_ajax_stripe_intents"),d.append("post_id",m.find('input[name="post_id"]').val()),d.append("form_id",m.find('input[name="form_id"]').val()),d.append("fields",JSON.stringify(r)),d.append("referrer",window.location.href),d.append("remote_ip",e(document).find('input[name="remote_ip"][data-piotnetforms-hidden-form-id="'+t+'"]').val()),d.append("stripeToken",o.token.id),d.append("amount",a),d.append("description",p),null!=e(this).data("piotnetforms-woocommerce-product-id")&&d.append("product_id",e(this).data("piotnetforms-woocommerce-product-id")),null!=l.data("piotnetforms-submit-post-edit")&&d.append("edit",l.data("piotnetforms-submit-post-edit")),null!=l.data("piotnetforms-submit-recaptcha")){var u=l.data("piotnetforms-submit-recaptcha");grecaptcha.ready((function(){grecaptcha.execute(u,{action:"create_comment"}).then((function(o){d.append("recaptcha",o),s.createPaymentMethod("card",f,{}).then((function(o){o.error||(d.append("payment_method_id",o.paymentMethod.id),e.ajax({url:e("[data-piotnetforms-ajax-url]").data("piotnetforms-ajax-url"),type:"POST",data:d,processData:!1,contentType:!1,success:function(o){var n=e(document).find('input[name="post_id"][data-piotnetforms-hidden-form-id="'+t+'"]').eq(0).closest("[data-piotnetforms-id]").data("piotnetforms-id"),p=JSON.stringify(r);i(JSON.parse(o),n,t,p,a,s,d,m,e(this)),f.clear()},error:function(){e(document).find('[data-piotnetforms-id="'+t+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),m.css({opacity:1}),m.removeClass("piotnetforms-waiting"),m.find(".piotnetforms-alert--stripe .piotnetforms-message-danger").addClass("visible"),m.find("[data-piotnetforms-trigger-failed]").trigger("click"),f.clear()}}))}))}))}))}else s.createPaymentMethod("card",f,{}).then((function(o){o.error||(d.append("payment_method_id",o.paymentMethod.id),e.ajax({url:e("[data-piotnetforms-ajax-url]").data("piotnetforms-ajax-url"),type:"POST",data:d,processData:!1,contentType:!1,success:function(o){var n=e(document).find('input[name="post_id"][data-piotnetforms-hidden-form-id="'+t+'"]').eq(0).closest("[data-piotnetforms-id]").data("piotnetforms-id"),p=JSON.stringify(r);i(JSON.parse(o),n,t,p,a,s,d,m,e(this)),f.clear()},error:function(){e(document).find('[data-piotnetforms-id="'+t+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),m.css({opacity:1}),m.removeClass("piotnetforms-waiting"),m.find(".piotnetforms-alert--stripe .piotnetforms-message-danger").addClass("visible"),m.find("[data-piotnetforms-trigger-failed]").trigger("click"),f.clear()}}))}))}}))}}))}))}function i(e,a,s,r,n,d,p,l,f){e.error?o("failed",l,s,p,0,e):e.requires_action?e.subscriptions?d.handleCardPayment(e.payment_intent_client_secret).then((function(t){t.error||o("succeeded",l,s,p,0,e)})):d.handleCardAction(e.payment_intent_client_secret).then((function(f){f.error?o("failed",l,s,p,0,e):(p.delete("payment_method_id"),p.append("payment_intent_id",f.paymentIntent.id),t.ajax({url:t("[data-piotnetforms-ajax-url]").data("piotnetforms-ajax-url"),type:"POST",data:p,processData:!1,contentType:!1,success:function(t){console.log(t),i(JSON.parse(t),a,s,r,n,d,p,l)}}))})):o("succeeded",l,s,p,0,e)}function o(e,i,o,a,s,r){var n=i,d=!!r.status&&r.status;"failed"==e||"user_exists"===d?(t(document).find('[data-piotnetforms-id="'+o+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),n.css({opacity:1}),n.removeClass("piotnetforms-waiting"),"user_exists"===d&&n.find(".piotnetforms-alert--stripe .piotnetforms-message-danger").text(r.msg),n.find(".piotnetforms-alert--stripe .piotnetforms-message-danger").addClass("visible"),t(document).find('[data-piotnetforms-submit-form-id="'+o+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),n.find("[data-piotnetforms-trigger-failed]").trigger("click")):(a.delete("stripeToken"),a.delete("action"),a.append("action","piotnetforms_ajax_form_builder"),a.append("payment_intent_id",r.payment_intent_id),t.ajax({url:t("[data-piotnetforms-ajax-url]").data("piotnetforms-ajax-url"),type:"POST",data:a,processData:!1,contentType:!1,success:function(i){if(t(document).find('[data-piotnetforms-id="'+o+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),n.css({opacity:1}),n.removeClass("piotnetforms-waiting"),-1!==(i=i.trim()).indexOf(",")){var a=JSON.parse(i);if(n.find(".piotnetforms-message").each((function(){if(""!=a.post_url){var e=t(this).html().replace("[post_url]",'<a href="'+a.post_url+'">'+a.post_url+"</a>");t(this).html(e)}})),"succeeded"==e||"active"==e?(n.find(".piotnetforms-alert--stripe .piotnetforms-message-success").addClass("visible"),n.find("[data-piotnetforms-trigger-success]").trigger("click")):(n.find(".piotnetforms-alert--stripe .piotnetforms-message-danger").addClass("visible"),t(document).find('[data-piotnetforms-id="'+o+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),t(document).find('[data-piotnetforms-submit-form-id="'+o+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),n.find("[data-piotnetforms-trigger-failed]").trigger("click")),""!=a.payment_id?n.find(".piotnetforms-alert--mail .piotnetforms-message-success").addClass("visible"):(n.find(".piotnetforms-alert--mail .piotnetforms-message-danger").addClass("visible"),t(document).find('[data-piotnetforms-id="'+o+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),t(document).find('[data-piotnetforms-submit-form-id="'+o+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),""!=a.register_message&&n.find(".piotnetforms-alert--mail .piotnetforms-message-danger").html(a.register_message.replace(/###/g,","))),0!=n.find('input[name="redirect"]').length){var s=n.find('input[name="redirect"]').val().trim(),r=n.find('input[name="redirect"]').attr("data-piotnetforms-open-new-tab");-1!==i.indexOf(",")&&1==a.status&&(""!=a.post_url&&"[post_url]"==s||""!=a.redirect)&&("yes"==r?window.open(a.redirect,"_blank"):window.location.href=a.redirect)}0!=t(document).find('[data-piotnetforms-popup][data-piotnetforms-hidden-form-id="'+o+'"]').length&&t(document).find('[data-piotnetforms-popup][data-piotnetforms-hidden-form-id="'+o+'"]').trigger("click"),0!=t(document).find('[data-piotnetforms-popup-open][data-piotnetforms-hidden-form-id="'+o+'"]').length&&t(document).find('[data-piotnetforms-popup-open][data-piotnetforms-hidden-form-id="'+o+'"]').trigger("click"),0!=t(document).find('[data-piotnetforms-popup-close][data-piotnetforms-hidden-form-id="'+o+'"]').length&&t(document).find('[data-piotnetforms-popup-close][data-piotnetforms-hidden-form-id="'+o+'"]').trigger("click")}}}))}t(document).on("piotnet-widget-init-Piotnetforms_Field","[data-piotnet-editor-widgets-item-root]",(function(){e(t(this),t)})),e(t("[data-piotnet-widget-preview], #piotnetforms"),t)}));