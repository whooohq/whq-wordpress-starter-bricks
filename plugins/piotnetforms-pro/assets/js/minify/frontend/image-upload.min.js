jQuery(document).ready((function(e){function t(){this.length=8,this.timestamp=+new Date,this.generate=function(){for(var e,t,a=this.timestamp.toString().split("").reverse(),o="",i=0;i<this.length;++i)o+=a[(e=0,t=a.length-1,Math.floor(Math.random()*(t-e+1))+e)];return o}}e(document).on("keyup change","[data-piotnetforms-image-upload]",(function(){var a=e(this).closest("label"),o=e(this).closest(".piotnetforms-fields-wrapper"),i=1e3;if(void 0!==a.attr("data-piotnetforms-image-upload-max-files")){i=parseInt(a.attr("data-piotnetforms-image-upload-max-files"));var n=o.find(".piotnetforms-image-upload-placeholder.piotnetforms-image-upload-uploaded:not(.piotnetforms-image-upload-delete)").length;i-=n}e.each(e(this)[0].files,(function(n,d){if(i>0){i-=1;var p=d.name,l=p.substring(p.lastIndexOf(".")+1).toLowerCase();if("gif"==l||"png"==l||"jpg"==l||"jpeg"==l)if("undefined"!=typeof FileReader){"multiple"!=a.attr("multiple")&&a.hide(0);var s=(new t).generate(),r=new FileReader;r.onload=function(e){(new Image).src=e.target.result,a.before('<div class="piotnetforms-image-upload-placeholder piotnetforms-image-upload-uploading" style="background-image:url('+e.target.result+')" data-piotnetforms-image-upload-placeholder="'+s+'"><input type="text" style="display:none;" data-piotnetforms-image-upload-item><span class="piotnetforms-image-upload-button piotnetforms-image-upload-button--remove" data-piotnetforms-image-upload-button-remove><i class="fa fa-times" aria-hidden="true"></i></span><span class="piotnetforms-image-upload-button piotnetforms-image-upload-button--uploading" data-piotnetforms-image-upload-button-uploading><i class="fa fa-spinner fa-spin"></i></span></div>')},r.readAsDataURL(d);var m=new FormData;m.append("upload",d),e.ajax({url:e("[data-piotnetforms-tinymce-upload]").data("piotnetforms-tinymce-upload"),type:"POST",data:m,processData:!1,contentType:!1,success:function(t){var a=JSON.parse(t),i=e(document).find('[data-piotnetforms-image-upload-placeholder="'+s+'"]');if(1==i.length){i.removeClass("piotnetforms-image-upload-uploading").addClass("piotnetforms-image-upload-uploaded"),i.find("input").attr("value",a.location);var n="";o.find("[data-piotnetforms-image-upload-placeholder]:not(.piotnetforms-image-upload-delete) [data-piotnetforms-image-upload-item]").each((function(){n+=e(this).val()+","})),n=n.replace(/.$/,""),o.find("[data-piotnetforms-id]").attr("value",n),o.find("[data-piotnetforms-id]").val(n),o.find("[data-piotnetforms-id]").change()}}})}else alert("Your browser does not support");0==i&&a.hide(0)}else a.hide(0)}))})),e(document).on("click","[data-piotnetforms-image-upload-button-remove]",(function(){var t=e(this).closest(".piotnetforms-image-upload-placeholder");t.css({display:"none"}),t.addClass("piotnetforms-image-upload-delete");var a=e(this).closest(".piotnetforms-fields-wrapper"),o=a.find("[data-piotnetforms-image-upload-placeholder]:not(.piotnetforms-image-upload-delete) [data-piotnetforms-image-upload-item]"),i="",n=a.find("[data-piotnetforms-image-upload-label]");0==o.length&&n.show(0),"multiple"==n.attr("multiple")&&n.show(0),o.each((function(){i+=e(this).val()+","})),i=i.replace(/.$/,""),a.find("[data-piotnetforms-id]").val(i),a.find("[data-piotnetforms-id]").change()}))}));