!function(r){window.GFCSAdmin={getDefaultInputs:function(e){for(var t=r.extend(!0,[],gformChainedSelectData.defaultInputs),i=0;i<t.length;i++)t[i].id=e.id+"."+(i+1);return t},updateAlignment:function(e){var t=GetSelectedField();t.chainedSelectsAlignment=e,r("#field_"+t.id).find(".ginput_container").removeClass("horizontal vertical").addClass(e)}};var e={gform_unique_id:"xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),field_id:null,form_id:null};function t(e){e.preventDefault()}function n(e,t){var e=r(e.settings.drop_element),i=r("#gfcs-sample");e.removeClass("gf-dragging"),t?(i.show(),e.show()):(i.hide(),e.hide())}function i(e){var t=plupload.formatSize(e.size).toUpperCase(),i=g(e),s=e.dateUploaded||Math.round(Date.now()/1e3),r=e.isFromFilter?"":'<span class="gfcs-remove"><i class="gficon-subtract"></i></span>',n=e.isFromFilter?'<div class="gfcs-source-message gforms_help_alert"><i class="fa fa-warning"></i> {0}</div>'.format(gformChainedSelectData.strings.importedFilterFile):"";return'\t\t\t<div id="{0}" class="{3}"> \t\t\t\t<span class="gfcs-file-icon"></span> {1} <span class="gfcs-file-size">{2}</span> <span class="gfcs-file-date"> | {4}</span> <b class="gfcs-file-percent"></b> \t\t\t\t<span class="gfcs-success"><i class="gficon-tick gf_valid"></i></span> \t\t\t\t{5} \t\t\t\t<span class="gfcs-processing"></span> \t\t\t</div> \t\t\t{6}'.format(e.id,e.name,t,i,function(e){var t,i=Date.now()/1e3-e,s={hours:{period:3600,label:{singular:"hour",plural:"hours"}},minutes:{period:60,label:{singular:"min",plural:"mins"}},seconds:{period:1,label:{singular:"sec",plural:"secs"}}};for(t in s)if(s.hasOwnProperty(t)){var r=s[t],n=Math.round(i/r.period),a="";if("hours"==t&&24<=n)break;if("seconds"==t&&0==n)a="{0} {1} ago".format(1,r.label.singular);else if(0<n){r=1<n?r.label.plural:r.label.singular;a="{0} {1} ago".format(n,r);break}}a||(e=new Date(1e3*e).toDateString().split(" "),a="{0} {1}, {2}".format(e[1],e[2],e[3]));return a}(s),r,n)}function a(e,t){e=r(e.settings.progress);t?e.html(i(t)):e.html("")}function l(e){for(var t=r("#field_"+e.id+" .ginput_container"),i="",s=0;s<e.inputs.length;s++)i+='<span><select disabled="disabled">'+("<option>"+e.inputs[s].label+"</option>")+"</select></span>\n";t.html(i)}function o(e){var t=GetSelectedField();return t&&(void 0===e.field||e.field.id==t.id)}function d(e){e.stop(),e.refresh(),e.start()}function c(e){e.files.splice(0,e.files.length),e.refresh(),e.start();var t=GetFieldById(e.field.id);t.choices=gformChainedSelectData.defaultChoices,t.inputs=f(t),t.gfcsFile=null,l(t),a(e,!1),n(e,!0)}function f(e){for(var t=r.extend(!0,[],gformChainedSelectData.defaultInputs),i=0;i<t.length;i++)t[i].id=e.id+"."+(i+1);return t}function g(e){return"gfcs-status-{0}".format(function(e){var t="";t=e.status&&e.status==plupload.UPLOADING?100==e.percent?"processing":"uploading":"complete";return t}(e))}function u(e,t){delete window.gfcsErrorTimeout,r("#gfcs-error").remove();var i=r('<div id="gfcs-error" class="error" style="width:375px;padding:1px 12px;"><p>{0}</p></div>'.format(t));r(e.settings.progress).html(i),window.gfcsErrorTimeout=setTimeout(function(){i.slideUp(function(){i.remove()})},1e4)}e["_gform_file_upload_nonce_{0}".format(form.id)]=window.gform_chainedselects_file_upload_nonce,new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:document.getElementById("pickfiles"),container:document.getElementById("gfcs-container"),progress:document.getElementById("gfcs-progress"),drop_element:document.getElementById("gfcs-drop"),dragdrop:!0,url:gformChainedSelectData.fileUploadUrl,filters:{max_file_size:parseInt(gformChainedSelectData.maxFileSize)/1e6+"mb",mime_types:[{title:"",extensions:"csv"}]},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap",multipart_params:e,init:{PostInit:function(s){r(document).bind("gform_load_field_settings",function(e,t,i){o(s)||d(s),"chainedselect"==t.type&&(t.gfcsFilterEnabled&&!t.gfcsFile?(r(s.settings.progress).html('<div class="gfcs-source-message gforms_red_alert"><i class="fa fa-warning"></i> {0}</div>'.format(gformChainedSelectData.strings.errorImportingFilterFile)),n(s,!1)):(s.field=r.extend({},t),document.getElementById("gfcs-progress").innerHTML="",t.gfcsFile?(a(s,t.gfcsFile),n(s,!1)):c(s)))}),r(s.settings.drop_element).on("dragover",function(){r(this).addClass("gf-dragging")}).on("dragleave",function(){r(this).removeClass("gf-dragging")}),r(s.settings.drop_element).on({dragenter:t,dragover:t}),r(s.settings.progress).on("click","span.gfcs-remove",function(){s.field.gfcsFilterEnabled||c(s)}),gform.addFilter("gform_duplicate_field_chainedselect",function(e){return e.gfcsFilterEnabled&&(e.gfcsFile=null,e.gfcsFilterEnabled=!1,e.choices=gformChainedSelectData.defaultChoices,e.inputs=f(e)),e})},FilesAdded:function(s,e){n(s,!1);var i,t=s.files.length;e=s.files,1<t&&(i=e.length-1,r.each(e,function(e,t){e<i&&s.removeFile(t)})),r.each(e,function(e,t){var i;t.status==plupload.FAILED?s.removeFile(t):(a(s,t),r("#"+t.id).attr("class",g(t)),(i=s.getOption("multipart_params")).field_id=field.id,i.form_id=form.id,i.original_filename=t.name,s.setOption("multipart_params",i))}),s.refresh(),s.start()},UploadProgress:function(e,t){o(e)?(document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML="<span>"+t.percent+"%</span>",r("#"+t.id).attr("class",g(t))):d(e)},Error:function(e,t){c(e);var i=t.message;-601==t.code?i=gformChainedSelectData.strings.errorFileType:-600==t.code&&(i=gformChainedSelectData.strings.errorFileSize),u(e,gformChainedSelectData.strings.errorUploadingFile+"<br>Error: "+t.code+", Message: "+i)},FileUploaded:function(e,t,i){var s;try{s=r.secureEvalJSON(i.response)}catch(e){s={status:"error",error:{message:!1}}}"error"==s.status?(c(e),u(e,gformChainedSelectData.strings.errorProcessingFile+"<br>Error: "+s.error.code+", Message: "+s.error.message)):100==t.percent&&s.status&&"ok"==s.status&&((i=GetSelectedField()).choices=s.data.choices,i.inputs=s.data.inputs,i.gfcsFile={name:t.name,type:t.type,size:t.size,dateUploaded:Math.round((new Date).getTime()/1e3),isFromFilter:!1},l(i),r("#"+t.id).attr("class",g(t)))}}}).init()}(jQuery);