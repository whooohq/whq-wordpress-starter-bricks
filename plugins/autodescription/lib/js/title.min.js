'use strict';window.tsfTitle=function(){const a="undefined"!=typeof tsfTitleL10n&&tsfTitleL10n,b=tsf.escapeString(a.params.untitledTitle),c=tsf.escapeString(a.i18n.protectedTitle),d=tsf.escapeString(a.i18n.privateTitle),e=!!a.params.stripTitleTags,f=new Map,g={},h=new Map,i=new Map,j=a=>h.get(a)||"",k=a=>i.get(a)||"",l=(a,b)=>h.set(a,b)&&j(a),m=(a,b)=>i.set(a,b)&&k(a),n=a=>document.getElementById(`tsf-title-placeholder-prefix_${a}`)||document.createElement("span"),o=a=>document.getElementById(`tsf-title-placeholder-additions_${a}`)||document.createElement("span"),p=a=>f.get(a),q=(a,b)=>b?g[a]?.[b]:g[a],r=(a,b,c)=>{if(g[a][b]!==c)switch(g[a][b]=c,b){case"showPrefix":case"prefixValue":case"prefixPlacement":w(a),G(a);break;case"addAdditions":case"separator":case"additionValue":case"additionPlacement":v(a),G(a);break;case"allowReferenceChange":case"defaultTitle":default:G(a);}},s=a=>{let b=[document.getElementById(`tsf-title-reference_${a}`)];if(q(a,"hasLegacy")){let a=document.getElementById("tsf-title-reference");a&&b.unshift(a)}return b},t=a=>[document.getElementById(`tsf-title-noadditions-reference_${a}`)],u=a=>{const b=s(a.target.id),c=t(a.target.id);if(!b[0]||!c[0])return;const d=q(a.target.id,"allowReferenceChange");let e=d&&a.target.value.trim()||q(a.target.id,"defaultTitle")||"",f=e;if(e.length&&d){let b=k(a.target.id),c=j(a.target.id);if(b.length&&q(a.target.id,"showPrefix")){switch(q(a.target.id,"prefixPlacement")){case"before":window.isRtl?e+=b:e=b+e;break;case"after":window.isRtl?e=b+e:e+=b;}f=e}if(c.length)switch(q(a.target.id,"additionPlacement")){case"before":e=c+e;break;case"after":e+=c;}}const g=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(tsf.sTabs(tsf.sSingleLine(e).trim())))),h=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(tsf.sTabs(tsf.sSingleLine(f).trim())))),i=new Event("change");b.forEach(a=>{a.innerHTML=g,setTimeout(()=>{a.dispatchEvent(i)},0)}),c.forEach(a=>{a.innerHTML=h,setTimeout(()=>{a.dispatchEvent(i)},0)})},v=a=>{let b="",c="",d="";if(q(a,"addAdditions")&&(c=tsf.escapeString(tsf.decodeEntities(q(a,"additionValue"))),d=q(a,"separator")),c)switch(q(a,"additionPlacement")){case"before":b=`${c} ${d} `;break;case"after":b=` ${d} ${c}`;}o(a).innerHTML=l(a,b||"")},w=a=>{let b="",c=q(a,"showPrefix"),d=q(a,"prefixValue");if(c&&d)switch(q(a,"prefixPlacement")){case"before":b=window.isRtl?` ${d}`:`${d} `;break;case"after":b=window.isRtl?`${d} `:` ${d}`;}n(a).innerHTML=m(a,b||"")},x=a=>{var b=Math.max,c=Math.min;let d=o(a.target.id),e=n(a.target.id);if(!d&&!e)return;const f=a.target,g=a.target.value,h=k(a.target.id).length&&q(a.target.id,"showPrefix"),i=!!j(a.target.id).length;if(!h&&e&&(e.style.display="none"),!i&&d&&(d.style.display="none"),!h&&!i)return void(f.style.textIndent="initial");if(!g.length)return f.style.textIndent="initial",e&&(e.style.display="none"),void(d&&(d.style.display="none"));const l=getComputedStyle(f),m=f.getBoundingClientRect(),p=parseInt(l.paddingTop),r=parseInt(l.paddingRight),s=parseInt(l.paddingBottom),t=parseInt(l.paddingLeft),u=parseInt(l.borderTopWidth),v=parseInt(l.borderRightWidth),w=parseInt(l.borderBottomWidth),x=parseInt(l.borderTopWidth),y=parseInt(l.marginTop),z=parseInt(l.marginRight),A=parseInt(l.marginBottom),B=parseInt(l.marginLeft),C=window.isRtl?"right":"left",D=t+x+B;let E={display:l.display,lineHeight:l.lineHeight,fontFamily:l.fontFamily,fontWeight:l.fontWeight,fontSize:l.fontSize,letterSpacing:l.letterSpacing,marginTop:`${y}px`,marginBottom:`${A}px`,paddingTop:`${p}px`,paddingBottom:`${s}px`,border:`0 solid transparent`,borderTopWidth:`${u}px`,borderBottomWidth:`${w}px`},F=0,G=0,H=0,I=0,J=0;if(h&&(Object.assign(e.style,E,{maxWidth:"initial"}),J=e.getBoundingClientRect().width,H+=D),i){Object.assign(d.style,E,{maxWidth:"initial"});const e=document.getElementById(`tsf-title-offset_${a.target.id}`);e.textContent=g,Object.assign(e.style,{fontFamily:E.fontFamily,fontWeight:E.fontWeight,fontSize:E.fontSize,letterSpacing:E.letterSpacing});const f=e.getBoundingClientRect().width,h=d.getBoundingClientRect().width;switch(q(a.target.id,"additionPlacement")){case"before":F=m.width-(r+v+z)-t-x-f-J,0>F&&(J+=F,F=0),F=b(0,c(F,h)),I+=F,H+=F,G+=D;break;case"after":F=m.width-D-r-v-f-J,0>F&&(J+=F,F=0),F=b(0,c(F,h)),G+=D+f+J;}}J=b(0,J),h&&(Object.assign(e.style,{[C]:`${H}px`,maxWidth:`${J}px`}),I+=J),i&&Object.assign(d.style,{[C]:`${G}px`,maxWidth:`${F}px`}),f.style.textIndent=`${I}px`},y=a=>{a.target.placeholder=s(a.target.id)[0].textContent},z=a=>{if("tsfC"in window){const b=document.getElementById(`${a.target.id}_chars`),c=s(a.target.id)[0];b&&tsfC.updateCharacterCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}},A=a=>{if("tsfC"in window){const b=document.getElementById(`${a.target.id}_pixels`),c=s(a.target.id)[0];b&&tsfC.updatePixelCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}},B=a=>{if(a){let b=p(a);b&&b.dispatchEvent(new Event("input"))}else f.forEach(a=>a.id&&B(a.id))},C=a=>{if(a){let b=p(a);b&&b.dispatchEvent(new CustomEvent("tsf-update-title-counter"))}else f.forEach(a=>a.id&&C(a.id))},D=a=>{x(a),u(a),y(a),E(a)},E=a=>{z(a),A(a)};let F={};const G=a=>{a in F&&clearTimeout(F[a]),F[a]=setTimeout(()=>B(a),1e3/60)},H=a=>{if("tsfAys"in window){let b=tsfAys.areSettingsChanged();B(a),!b&&tsfAys.areSettingsChanged()&&tsfAys.reset()}else B(a)};let I={};const J=a=>{a in I&&clearTimeout(I[a]),I[a]=setTimeout(()=>H(a),1e3/60)},K=a=>{let b=document.getElementById(a.target.dataset.for);if(b){let c=a.target.classList.contains("tsf-title-placeholder-additions")?"additions":"prefix",d=b.value;switch(b.focus(),a.detail){case 3:b.setSelectionRange(0,d.length);break;case 2:let e,f;"additions"===c&&"after"===q(b.id,"additionPlacement")||"prefix"===c&&window.isRtl?(e=d.replace(/(\w+|\s+)$/u,"").length,f=d.length):(e=0,f=d.length-d.replace(/^(\s+|\w+)/u,"").length),b.setSelectionRange(e,f);break;case 1:default:let g="additions"===c&&"after"===q(b.id,"additionPlacement")?d.length:0;b.setSelectionRange(g,g);}}},L=a=>a.preventDefault();let M=window.innerWidth;const N=()=>{let a=window.innerWidth;M<a?782>=M&&782<=a&&H():782<=M&&782>=a&&H(),M=a},O=()=>{window.addEventListener("tsf-resize",N),window.addEventListener("tsf-counter-updated",()=>J())},P=a=>{if(!(!a instanceof Element)){a.addEventListener("input",D),a.addEventListener("tsf-update-title-counter",E);let b=n(a.id),c=o(a.id);b.addEventListener("click",K),c.addEventListener("click",K),b.addEventListener("mousedown",L),c.addEventListener("mousedown",L),v(a.id),w(a.id),J(a.id)}};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",O)}},{setInputElement:b=>(f.set(b.id,b),g[b.id]={showPrefix:!0,allowReferenceChange:!0,defaultTitle:"",separator:a.states.titleSeparator,prefixPlacement:a.states.prefixPlacement},P(b),p(b.id)),getInputElement:p,getStateOf:q,updateStateOf:r,updateStateAll:(a,b,c)=>{c=Array.isArray(c)?c:[c],f.forEach(d=>{c.includes(d.id)||r(d.id,a,b)})},triggerCounter:C,triggerInput:B,enqueueTriggerInput:G,triggerUnregisteredInput:H,enqueueUnregisteredInputTrigger:J},{l10n:a,untitledTitle:b,privatePrefix:d,protectedPrefix:c,stripTitleTags:e})}(),window.tsfTitle.load();
